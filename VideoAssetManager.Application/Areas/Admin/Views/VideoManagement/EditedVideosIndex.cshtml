@model IEnumerable<VM_EditedVideos>
@{
    Random random = new Random();
    int editedVideosListpageid = random.Next();

    ViewData["suggestionfor"] = "Export Videos";

    var strvideoFormatlist = ":[All]";
    var strvideoFormatEdit = "";
    var VideoFormatName = ViewBag.VideoFormatName;

    foreach (var ctype in VideoFormatName)
    {
        strvideoFormatlist += ";" + ctype.Value + ":" + ctype.Text;
        strvideoFormatEdit += (strvideoFormatEdit == "") ? (ctype.Value + ":" + ctype.Text) : (";" + ctype.Value + ":" + ctype.Text);
    }

    ViewData["AspAction"] = "CreateEditedVideos";
    ViewData["AspController"] = "VideoManagement";
    ViewData["Title"] = "Manage Export Videos";
    ViewData["ButtonText"] = "Add Export Videos";
}
<link href="~/JqGrid/css/jqGridPage-ui.css" rel="stylesheet" />
<style>
    .ui-jqgrid tr.jqgrow td {
        white-space: normal !important;
    }
</style>

<partial name="_FormCaptionAndButton" view-data="ViewData" />

@section Scripts
{
<script src="~/lib/jquery/dist/js/jquery-ui.min.js"></script>
<script src="~/lib/jquery/dist/js/trirand/i18n/grid.locale-en.js"></script>
<script src="~/lib/jquery/dist/js/trirand/jquery.jqgrid.min.js"></script>
<script src="~/autocomplete/ui-1.1.2.1.min.js"></script>

<script type="text/javascript">

    $(document).ready(function () {
        $("#clsCaption").html("Manage Export Videos");
        $("#SearchString").attr("placeholder", "Search for Export Videos");
        var selectedRows = [];
        var AllRows = [];

        $("#jqGrid").jqGrid({
            url: '/admin/VideoManagement/EditedVideosDetails',
            mtype: "GET",
            datatype: "json",
            contentType: "application/json",
            postData: { TopSearch: function () { return $('#SearchString').val(); }, editedVideosPageId: @editedVideosListpageid},
        colModel: [
            { label: 'Id', name: 'id', width: 100, align: "center", key: true, editable: true, hidden: true },
            { label: 'Project Name', name: 'projectName', width: 500, align: "left", editoptions: { value: "" }, editable: true, hidden: false, searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] }, coloptions: { filtering: false, seraching: false, freeze: false } },
            { label: 'RF ID', name: 'rfId', width: 350, align: "center", editoptions: { value: "" }, hidden: false, searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] }, coloptions: { filtering: false, seraching: false, freeze: false } },
            { label: 'Raw Title', name: 'title', width: 500, align: "left", editoptions: { value: "" }, editable: true, hidden: false, searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] }, coloptions: { filtering: false, seraching: false, freeze: false } },
            { label: 'Video Type',name: 'videoType',width: 250,align: "left",formatter: function(cellvalue, options, rowObject) {return cellvalue == 1 ? "Reel" : (cellvalue == 2 ? "Video" : "");},stype: "select",searchoptions: { value: "@strvideoFormatlist" },edittype: "select",editoptions: { value: "@strvideoFormatEdit" }, editable: true,coloptions: { filtering: false, seraching: false, freeze: false }},
            { label: 'Is For Rekhta App', name: 'isForRekhtaApp', formatter: IsForRekhtaApp, width: 250, align: "center", editable: true, stype: "select", searchoptions: { value: ":[All];true:Active;false:Inactive" }, coloptions: { filtering: false, seraching: false, freeze: false }, edittype: "custom", editoptions: { custom_element: myelemactive, custom_value: myvalueactive } },
            { label: 'Duration', name: 'duration', width: 200, align: "left", editoptions: { value: "" }, editable: true, hidden: false, searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] }, coloptions: { filtering: false, seraching: false, freeze: false } },
            { label: 'Size', name: 'size', width: 200, align: "left", editoptions: { value: "" }, editable: true, hidden: false, searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] }, coloptions: { filtering: false, seraching: false, freeze: false } },

            {
                label: 'Export File',
                name: 'videoFileName',
                width: 250,
                align: "center",
                editable: true,
                hidden: false,
                formatter: function (cellvalue, options, rowObject) {

                    var rfId = rowObject.rfId;

                    var videoFilePath = '@ViewData["appurl"]' + 'wcr/contentdirectory/media/' + rowObject.projectName + '/' + rfId + '/Exports/' + cellvalue;
                    var thumbFilePath = '@ViewData["appurl"]' + 'wcr/contentdirectory/media/' + rowObject.projectName + '/' + rfId + '/Thumb/' + rowObject.thumbnail;

                    return `<a href="#" class="video-link" data-url="${rowObject.videoFileName}"onclick="openVideoPopup('${videoFilePath}')"><img style='cursor:pointer; width: 100px;'  src=${thumbFilePath}><img></a>`;
                },
                searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] },
                coloptions: { filtering: false, seraching: false, freeze: false }
            },

            @*{
                label: 'Thumbnail',
                name: 'thumbnail',
                width: 350,
                align: "center",
                editable: true,
                hidden: false,
                formatter: function (cellvalue, options, rowObject) {

                    var rfId = rowObject.rfId;
                    var videoFilePath = '@ViewData["appurl"]' + '/wcr/contentdirectory/' + rowObject.projectName + '/'+ rfId +'/Thumb/' + cellvalue;

            return `<a href="#" class="video-link" data-url="${rowObject.thumbnail}"onclick="openVideoPopup('${videoFilePath}')">${cellvalue}</a>`;
                },
                searchoptions: { sopt: ["cn", "nc", "eq", "ne", "nu", "nn"] },
                coloptions: { filtering: false, seraching: false, freeze: false }
            },*@

            { label: 'Status', name: 'Active', formatter: IsActive, width: 150, align: "center", editable: true, stype: "select", searchoptions: { value: ":[All];true:Active;false:Inactive" }, coloptions: { filtering: false, seraching: false, freeze: false }, edittype: "custom", editoptions: { custom_element: myelemactive, custom_value: myvalueactive } },
            { label: 'Action', name: 'Edit', width: 70, align: "center", formatter: "actions", width: 250, formatoptions: { keys: true, onEdit: onEdit, afterRestore: reloadGrid, onSuccess: reloadGrid }, title: false, sortable: false, search: false, colmenu: false, hidden: false, editable: true },
        ],

        viewrecords: true,
        height: 'auto',
        rowNum: 25,
        rowList: [25, 50, 75, 100],
        multiselect: false,
        sortorder: "asc",
        sortname: "id",
        pager: "#jqGridPager",
        gridview: true,
        autoencode: true,
        sortable: true,
        colMenu: true,
        subGrid: false,
        autowidth: false,
        emptyrecords: 'No records to display',

        autowidth: true,
            editurl: '/admin/VideoManagement/DeleteEditedVideos',
        onSelectRow: function (rowId, status, e) {
            if (status === false) {
                var index = selectedRows.indexOf(rowId);
                while (index > -1) {
                    selectedRows.splice(index, 1);
                    index = selectedRows.indexOf(rowId);
                }
            } else {
                var index = selectedRows.indexOf(rowId);
                if (index == -1) {
                    selectedRows.push(rowId);
                }
            }
            $('#hdnSelectedRows').val(selectedRows.join(","));
        },

        onSelectRow: function (rowId, status, e) {
            if (status === false) {
                var index = selectedRows.indexOf(rowId);
                while (index > -1) {
                    selectedRows.splice(index, 1);
                    index = selectedRows.indexOf(rowId);
                }
                $('#hdnAllRows').val(false);
            } else {
                var index = selectedRows.indexOf(rowId);
                if (index == -1) {
                    selectedRows.push(rowId);
                }
            }
            $('#hdnSelectedRows').val(selectedRows.join(","));
        },
        onSelectAll: function (rowIds, status) {
            if (status === true) {
                var PageIds = $('#jqGrid').jqGrid('getDataIDs');
                $.each(PageIds, function (i) {
                    var index = selectedRows.indexOf(PageIds[i]);
                    if (index == -1) {
                        selectedRows.push(PageIds[i]);
                    }
                });
            } else {
                var PageIds = $('#jqGrid').jqGrid('getDataIDs');
                $.each(PageIds, function (i) {
                    var index = selectedRows.indexOf(PageIds[i]);
                    while (index > -1) {
                        selectedRows.splice(index, 1);
                        index = selectedRows.indexOf(PageIds[i]);
                    }
                });
                $('#hdnAllRows').val(false);
            }
            $('#hdnSelectedRows').val(selectedRows.join(","));
        },

        beforeSelectRow: function (rowid, e) {
            var $self = $(this),
                iCol = $.jgrid.getCellIndex($(e.target).closest("td")[0]),
                cm = $self.jqGrid("getGridParam", "colModel");
            if (cm[iCol].name === "View") {
                return false;
            }
            return true;
        },
        gridComplete: function () {
            var $self = $(this), rows = this.rows, i, iAction, tr,
                colModel = $self.jqGrid("getGridParam", "colModel"),
                idPrefix = $self.jqGrid("getGridParam", "idPrefix"),
                newOnClick = function (e) {
                    var rowid = $(this).closest(".jqgrow").attr("id");
                    e.stopPropagation();
                    window.location.href = "CreateEditedVideos?Id=" + rowid;
                };

            // find the index of the column with formatter: "actions"
            for (i = 0; i < colModel.length; i++) {
                if (colModel[i].formatter === "actions") {
                    iAction = i;
                    break;
                }
            }
            if (iAction === undefined) {
                return;
            }
            for (i = 0; i < rows.length; i++) {
                tr = rows[i];
                if ($(tr).hasClass("jqgrow")) {
                    $(tr.cells[iAction]).find(".ui-inline-edit")
                        .click(newOnClick)      // register new click event handler
                        .prop("onclick", null); // remove standard behavior of Edit button
                }
            }
            $("#delmodjqGrid").attr("style:z-index: 950; top: 186px; left: 890px;");
        }
            });

    $('#jqGrid').jqGrid('filterToolbar', { stringResult: true, searchOperators: true });

    if ($(window).width() >= 1600) {
        $("#jqGrid").setGridWidth(Math.round($("#table-responsive").width() - 2, true));
    }
    else {
        $("#jqGrid").setGridWidth(Math.round($("#table-responsive .inner_width").width(), true));
    }
        });

    function reloadGrid(cellValue, options, rowdata, action) {

        $('#jqGrid').trigger('reloadGrid');
    }
    $(window).resize(function () {

        setTimeout(function () {
            if ($(window).width() >= 1600) {
                $("#jqGrid").setGridWidth(Math.round($("#table-responsive").width() - 2, true));
            }
            else {
                $("#jqGrid").setGridWidth(Math.round($("#table-responsive .inner_width").width(), true));
            }
        }, 500);
    });

    $('.sidebar-toggle').click(function () {

        setTimeout(function () {
            if ($(window).width() >= 1200) {
                $("#jqGrid").setGridWidth(Math.round($("#table-responsive").width() - 2, true));
            }
            else {
                $("#jqGrid").setGridWidth(Math.round($("#table-responsive .inner_width").width(), true));
            }
        }, 500);
    });
    function onEdit(cellValue, options, rowdata, action) {



    }
    $('#SearchString').bind("enterKey", function (e) {
        $('#jqGrid').trigger('reloadGrid');
    });
    $('#SearchString').keyup(function (e) {
        if (e.keyCode == 13) {
            $(this).trigger("enterKey");
            $('#jqGrid').trigger('reloadGrid');
        }
    });

    function myelemactive(value, options) {
        var el = document.createElement("select");
        el.className = "editable inline-edit-cell ui-widget-content ui-corner-all";
        el.style = "width: 100%;";
        var selected = value.includes("JQcheck", 0);
        if (selected) {
            el.options.add(new Option("Active", "true", true, true));
            el.options.add(new Option("Inactive", "false"));
        }
        else {
            el.options.add(new Option("Active", "true"));
            el.options.add(new Option("Inactive", "false", true, true));
        }
        return el;
    }
    function myvalueactive(elem, operation, value) {
        if (operation === 'get') {
            return $(elem).val();
        } else if (operation === 'set') {
            $('select', elem).val(value);
        }
    }


    function IsActive(cellValue, options, rowdata, action) {

        if (rowdata.active == true) {
            return "<img style='cursor:pointer; width:25px;' title='Click to Deactivate' onclick=ChangeVideoStatus('" + rowdata.id + "') src=@ViewData["appurl"]JqGrid/css/images/JQcheck.png><img>";
        }
        else {
            return "<img style='cursor:pointer; width:25px;' title='Click to Activate' onclick= ChangeVideoStatus('" + rowdata.id + "') src=@ViewData["appurl"]JqGrid/css/Images/JQclose.PNG><img>";
        }
    }
    function IsForRekhtaApp(cellValue, options, rowdata, action) {

        if (rowdata.isForRekhtaApp == true) {
            return "<img style='cursor:pointer; width:25px;' title='Click to Change' onclick=ChangeIsMobileAppStatus('" + rowdata.id + "') src=@ViewData["appurl"]JqGrid/css/images/JQcheck.png><img>";
        }
        else {
            return "<img style='cursor:pointer; width:25px;' title='Click to Change' onclick= ChangeIsMobileAppStatus('" + rowdata.id + "') src=@ViewData["appurl"]JqGrid/css/Images/JQclose.PNG><img>";
        }
    }
    function ChangeVideoStatus(id) {
        if (confirm('Are you sure to continue?')) {
            $.ajax({
                url: '/admin/VideoManagement/ChangeEditedVideoStatus',
                type: "GET",
                data: { Id: id },
                crossDomain: true,
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                dataType: "json",
                headers: {},
                crossDomain: true,
                charset: "UTF-8",
                cache: false,
                xhrFields: {
                    withCredentials: true
                },
                error: function () {
                    console.log('error');
                },
                success: function (data) {
                    if (data.status == 1) {
                        $("#hdnGuid").val('');
                        $('#jqGrid').trigger('reloadGrid');
                    }
                    else {
                        alert(data.Error);
                        $("#hdnGuid").val('');
                        $('#jqGrid').trigger('reloadGrid');

                    }
                }
            });
        }
    }
        function ChangeIsMobileAppStatus(id) {
            if (confirm('Are you sure to continue?')) {
                $.ajax({
                    url: '/admin/VideoManagement/ChangeIsMobileAppStatus',
                    type: "GET",
                    data: { Id: id },
                    crossDomain: true,
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    dataType: "json",
                    headers: {},
                    crossDomain: true,
                    charset: "UTF-8",
                    cache: false,
                    xhrFields: {
                        withCredentials: true
                    },
                    error: function () {
                        console.log('error');
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            $("#hdnGuid").val('');
                            $('#jqGrid').trigger('reloadGrid');
                        }
                        else {
                            alert(data.Error);
                            $("#hdnGuid").val('');
                            $('#jqGrid').trigger('reloadGrid');

                        }
                    }
                });
            }
        }

        function openVideoPopup(videoUrl) {
            if (videoUrl) {
                $("#videoSource").attr("src", videoUrl);
                $("#videoPlayer")[0].load(); // Reload the video
                $("#videoPopup").modal("show"); // Open the modal
            } else {
                alert("Video not available.");
            }
        }

</script>
}